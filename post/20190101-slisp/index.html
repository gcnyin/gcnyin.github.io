<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="之前经常变更学习方向，没有收到很好的学习效果，浪费了不少时间。最近痛定思痛，把方向定为JVM和编译原理，这次真的不改了。本文是学习该方向的阶"><title>slisp：一门简单的JVM上的Lisp方言</title><link rel=canonical href=https://blog.boluotou.tech/post/20190101-slisp/><link rel=stylesheet href=/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css><meta property="og:title" content="slisp：一门简单的JVM上的Lisp方言"><meta property="og:description" content="之前经常变更学习方向，没有收到很好的学习效果，浪费了不少时间。最近痛定思痛，把方向定为JVM和编译原理，这次真的不改了。本文是学习该方向的阶"><meta property="og:url" content="https://blog.boluotou.tech/post/20190101-slisp/"><meta property="og:site_name" content="菠萝头"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="compiler"><meta property="article:published_time" content="2019-01-01T21:00:00+08:00"><meta property="article:modified_time" content="2019-01-01T21:00:00+08:00"><meta name=twitter:title content="slisp：一门简单的JVM上的Lisp方言"><meta name=twitter:description content="之前经常变更学习方向，没有收到很好的学习效果，浪费了不少时间。最近痛定思痛，把方向定为JVM和编译原理，这次真的不改了。本文是学习该方向的阶"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/cat2_hu198e5c50a5536143e7e5e175fde04142_32384_300x0_resize_q75_box.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>菠萝头</a></h1><h2 class=site-description>一个充满好奇心的程序员</h2></div></header><ol class=social-menu><li><a href=https://github.com/gcnyin target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/page/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/page/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/page/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#一前言>一、前言</a></li><li><a href=#二编译和运行>二、编译和运行</a></li><li><a href=#三编译器组成>三、编译器组成</a></li><li><a href=#四字节码简介>四、字节码简介</a></li></ul></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/post/20190101-slisp/>slisp：一门简单的JVM上的Lisp方言</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jan 01, 2019</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><p>之前经常变更学习方向，没有收到很好的学习效果，浪费了不少时间。最近痛定思痛，把方向定为JVM和编译原理，这次真的不改了。本文是学习该方向的阶段性总结。</p><h2 id=一前言>一、前言</h2><p>之前写过几个解释器，但还没写过编译器。刚好看到知乎Belleve给出的一幅学习路线图，于是决定实现一个lisp方言的编译器。</p><p>之所以选择JVM而不是X86作为目标平台，一是JVM平常用的多一些，可以互相印证、互相补充；二是文档和社区资源丰富友好，开发体验较好。</p><p>项目地址：https://github.com/gcnyin/slisp</p><p>截止最新的commit 77f126d4，实现的功能有：</p><ul><li>定义变量</li><li>支持字符串、整数和布尔类型</li><li>打印以上三种预置类型的值</li><li>四则运算</li><li>条件判断</li></ul><h2 id=二编译和运行>二、编译和运行</h2><p>来一段具体的Slisp程序：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lisp data-lang=lisp><span style=display:flex><span>(define a (<span style=color:#a6e22e>+</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(println a)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(define b (<span style=color:#a6e22e>+</span> a a))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(println b)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(define a (<span style=color:#a6e22e>+</span> b b))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(println a)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(println (<span style=color:#a6e22e>+</span> (<span style=color:#a6e22e>+</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>-</span> <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>*</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>/</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>2</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(println <span style=color:#e6db74>&#34;Hello Slisp!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(define c <span style=color:#e6db74>&#34;Hello world!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(println c)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(println true)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(println false)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(define d true)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(println d)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>if</span> true (println true) (println false))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>if</span> (== <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span>) (println <span style=color:#e6db74>&#34;1 == 1&#34;</span>) (println <span style=color:#e6db74>&#34;1 != 1&#34;</span>))
</span></span></code></pre></div><p>以上程序出自本项目/Slisp/Hello.slisp。</p><p>想要运行必须先打包编译器：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./gradlew clean build
</span></span></code></pre></div><p>得到了build/libs/slisp-0.1.0.jar，之后在命令行编译源代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -jar build/libs/slisp-0.1.0.jar Slisp/Hello.slisp
</span></span></code></pre></div><p>即可生成Hello.class文件，java Hello运行该文件，输出为：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>Hello Slisp!
</span></span><span style=display:flex><span>Hello world!
</span></span><span style=display:flex><span>true
</span></span><span style=display:flex><span>false
</span></span><span style=display:flex><span>true
</span></span><span style=display:flex><span>true
</span></span><span style=display:flex><span><span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><h2 id=三编译器组成>三、编译器组成</h2><p>这个编译器由三部分组成，一是前端部分，二是构建抽象语法树，三是递归下降生成字节码。</p><p>前端部分使用了Antlr来构建。Antlr是一个流行的parser generator，可以根据给定的文法，生成相应的parser。因为Slisp本身采用了lisp系的语法，并不复杂，所以很容易写出文法供Antlr使用。</p><p>构建抽象语法树使用了visitor模式。由于Antlr本身返回的结果已经是一棵树，所以这部分的工作是，根据每个节点不同的形态创建相应的类和实例。</p><p>这里有一些实现上的细节可以优化，比如针对四则运算，可以将这些运算全部用一个类来表示，只更改其中的一个字段以示区别。还有一点是，如果打算只使用一个visitor，那么每个节点类都需要继承同一个接口或父类。</p><p>还有，实现了一点简单的类型推导。传统的lisp方言大多是动态语言，不过Slisp是静态的，而且可以在定义变量时推导出变量的类型，不需要开发者手动声明变量的类型。(define a 123)、(define b &ldquo;Hello&rdquo;)和(define c true)可以由字面值推导出类型，而(define d (+ 1 (- 2 3))也可以推导出表达式(+ 1 (- 2 3))的类型并以此确定d的类型。</p><p>生成字节码部分采用了递归下降来生成。比如对(+ (+ 1 1) (- 6 4) (* 2 2) (/ 4 2))，生成了：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>      44: bipush        <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      46: bipush        <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      48: iadd
</span></span><span style=display:flex><span>      49: bipush        <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>      51: bipush        <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>      53: isub
</span></span><span style=display:flex><span>      54: iadd
</span></span><span style=display:flex><span>      55: bipush        <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>      57: bipush        <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>      59: imul
</span></span><span style=display:flex><span>      60: iadd
</span></span><span style=display:flex><span>      61: bipush        <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>      63: bipush        <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>      65: idiv
</span></span><span style=display:flex><span>      66: iadd
</span></span></code></pre></div><p>这段代码是Hello.class文件中的一部分，使用OpenJDK中的javap反汇编器生成。</p><p>(+ 1 1)对应44、46和48，先将两个1压入栈中，然后相加，将之前的两个人从栈中弹出，然后将结果压入栈顶，继续执行(- 6 4)。</p><p>这里需要注意的是，并不是说执行完这四个运算(+ 1 1) (- 6 4) (* 2 2) (/ 4 2)，然后再计算它们的和。而是在计算完(+ 1 1)和(- 6 4)之后（结果为2和2），立即计算了(+ 2 2)（得到4），然后计算(* 2 2)（得到4），再计算(+ 4 4)，以此类推。过程如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>+ <span style=color:#f92672>(</span>+ <span style=color:#ae81ff>1</span> 1<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>- <span style=color:#ae81ff>6</span> 4<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>* <span style=color:#ae81ff>2</span> 2<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>/ <span style=color:#ae81ff>4</span> 2<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>+ <span style=color:#ae81ff>2</span> <span style=color:#f92672>(</span>- <span style=color:#ae81ff>6</span> 4<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>* <span style=color:#ae81ff>2</span> 2<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>/ <span style=color:#ae81ff>4</span> 2<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>+ <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>(</span>* <span style=color:#ae81ff>2</span> 2<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>/ <span style=color:#ae81ff>4</span> 2<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>+ <span style=color:#ae81ff>4</span> <span style=color:#f92672>(</span>* <span style=color:#ae81ff>2</span> 2<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>/ <span style=color:#ae81ff>4</span> 2<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>+ <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>(</span>/ <span style=color:#ae81ff>4</span> 2<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>+ <span style=color:#ae81ff>8</span> <span style=color:#f92672>(</span>/ <span style=color:#ae81ff>4</span> 2<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>+ <span style=color:#ae81ff>8</span> 2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>10<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>为了契合这样的字节码运算方式，后端在创建抽象语法树的时候需要注意“左结合与右结合”的问题。这里采用了右结合的方式，大致结构如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>+ <span style=color:#f92672>(</span>/ <span style=color:#ae81ff>4</span> 2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>(</span>+ <span style=color:#f92672>(</span>* <span style=color:#ae81ff>2</span> 2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>(</span>+ <span style=color:#f92672>(</span>- <span style=color:#ae81ff>6</span> 4<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>(</span>+ <span style=color:#ae81ff>1</span> 1<span style=color:#f92672>))))</span>
</span></span></code></pre></div><p>这样从底层开始生成字节码，每生成一层，就向上传递，继续生成上层节点的字节码。</p><p>实际开发中使用了ASM库来辅助生成字节码，只需要手动拼接好类似于bipush 1这样的文本传给ASM中合适的类和方法，最后调用generateBytecode这样的方法即可。</p><p>虽然ASM库很方便，但想要生成符合语义的字节码，开发者仍需要阅读JVM规范。JVM规范中定义了各字节码的名称与语义，对照着网络上的众多示例还是很容易理解的。</p><h2 id=四字节码简介>四、字节码简介</h2><p>bipush是指将一个类型为byte扩充为int，然后压到栈上。</p><p>iadd是将栈最上面的两个int弹出，然后计算它们的和，将结果压入栈顶。imul、isub和idiv都类似于iadd，不同之处在于将运算符变为了*、-和/。</p><p>istore将int保存在局部变量中。</p><p>iload从局部变量中取出保存在其中的值。</p><p>astore是将对一个Ojbect的引用保存在局部变量中。</p><p>alocal是将保存在局部变量中的引用压入栈顶。</p><p>ifeq是将栈顶的值与0进行比较，如果相等，进入true branch，否则进行false branch。该指令还会指定一个数字作为false branch入口的地址。</p><p>if_icmpne是比较栈上的两个类型为int的值，如果不相等，进入true branch，否则进入false branch。</p><p>值得注意的是，诸如if这样的指令并不是单个存在，它们更多的像是一个家庭，比如比较两个int会有许多相似的指令，从JVM规范中抄录一段：</p><pre tabindex=0><code>• if_icmpeq succeeds if and only if value1 = value2
• if_icmpne succeeds if and only if value1 ≠ value2
• if_icmplt succeeds if and only if value1 &lt; value2
• if_icmple succeeds if and only if value1 ≤ value2
• if_icmpgt succeeds if and only if value1 &gt; value2
• if_icmpge succeeds if and only if value1 ≥ value2
</code></pre><p>可以看到if_icmpne只是用来比较两个数相等时的情况，还有其它指令用于比较不等、大于、小于、相等时的情况。像这样相似而略有区别的指令，JVM规范大多将它们的文档合并在一起，并起名为if_icmp，这里的cond代表每个指令独特的部分。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/compiler/>compiler</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License</span></section></footer></article><link rel=stylesheet href=/scss/partials/comments/disqusjs.min.css><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>let disqusjs;function loadDisqusJS(){disqusjs=new DisqusJS({shortname:"gcnyin",siteName:"菠萝头",apikey:"axEXO6tIip7EqeO3wdDoglRjBQgCwgK56jmZvsla1mBt7x9JHA2i5StHnonPvGLp"})}function lazyLoadDisqusJS(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}let e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/disqusjs@1.3/dist/disqus.js",e.async=!1,document.body.appendChild(e),e.onload=()=>{loadDisqusJS(),window.addEventListener("onColorSchemeChange",e=>{disqusjs&&loadDisqusJS()})}}let runningOnBrowser=typeof window!="undefined",isBot=runningOnBrowser&&!("onscroll"in window)||typeof navigator!="undefined"&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent),supportsIntersectionObserver=runningOnBrowser&&"IntersectionObserver"in window;if(!isBot&&supportsIntersectionObserver){let e=new IntersectionObserver(function(t){t[0].isIntersecting&&(lazyLoadDisqusJS(),e.disconnect())});e.observe(document.getElementById("disqus_thread"))}else lazyLoadDisqusJS()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><footer class=site-footer><section class=copyright>&copy;
2022 菠萝头</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>