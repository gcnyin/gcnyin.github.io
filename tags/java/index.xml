<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>java on 菠萝头</title><link>https://blog.boluotou.tech/tags/java/</link><description>Recent content in java on 菠萝头</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Fri, 13 Sep 2019 12:35:00 +0800</lastBuildDate><atom:link href="https://blog.boluotou.tech/tags/java/index.xml" rel="self" type="application/rss+xml"/><item><title>JVM if&lt;cond>指令笔记</title><link>https://blog.boluotou.tech/post/20190913-jvm-ifcond/</link><pubDate>Fri, 13 Sep 2019 12:35:00 +0800</pubDate><guid>https://blog.boluotou.tech/post/20190913-jvm-ifcond/</guid><description>&lt;pre tabindex="0">&lt;code>format: if&amp;lt;cond&amp;gt; branchByte1 branchByte2
&lt;/code>&lt;/pre>&lt;p>从栈中弹出一个值，和0进行比较，根据指令的不同，有不同的比较方法得出一个值，如果为假，则顺序执行后面的指令。那为真的呢？：&lt;/p>
&lt;p>branchByte1 branchByte2 都是 0x00 - 0xFF 之间的一个 unsigned 值，可以用他俩算出来offset作为true branch的入口，公式为：&lt;/p>
&lt;pre tabindex="0">&lt;code>(branchbyte1 &amp;lt;&amp;lt; 8) | branchbyte2
&lt;/code>&lt;/pre>&lt;p>例子：&lt;/p>
&lt;pre tabindex="0">&lt;code>116: bipush 1
118: ifeq 132
121: getstatic #12 // Field java/lang/System.out:Ljava/io/PrintStream;
124: bipush 1
126: invokevirtual #28 // Method java/io/PrintStream.println:(Z)V
129: goto 140
132: getstatic #12 // Field java/lang/System.out:Ljava/io/PrintStream;
135: bipush 0
&lt;/code>&lt;/pre>&lt;p>行中ifeq 132的二进制表示为99 00 0E。99代表该指令，00和0E代表两个操作数。&lt;/p>
&lt;p>计算偏移量：&lt;code>(0x00 &amp;lt;&amp;lt; 8) | 0x0E&lt;/code> 得 14&lt;/p>
&lt;p>就是说ifeq开头为118，加上14个偏移量为132，所以132是 true branch 的入口。&lt;/p>
&lt;p>问题：&lt;/p>
&lt;p>一、为什么需要两个操作数呢？&lt;/p>
&lt;p>（一）通过观察 java 编译后的 class 文件，我发现 branchByte1 都是 0x00，完全没有必要为这样一个固定的值设计一个位置呀。&lt;/p>
&lt;p>自答：如果 true branch 非常长（true branch 里的指令长度超过了255，那么 branchByte1 是会增长的。&lt;/p>
&lt;p>（二）&lt;code>(branchbyte1 &amp;lt;&amp;lt; 8) | branchbyte2&lt;/code>的结果还是8位，难道不可以用一个 byte 来表示，为什么需要用两个 byte 计算后得到结果呢？&lt;/p>
&lt;p>自答：如上所述，需要两个来处理 condition 很长的情况。&lt;/p></description></item></channel></rss>